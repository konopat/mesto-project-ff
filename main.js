(()=>{"use strict";var e,t=function(e){var t={method:"GET",endPoint:"/users/me",headers:{authorization:e.token}};return n(e,t).catch((function(t){return console.error("Ошибка запроса пользователя",t),e.anon}))},n=function(e,t){return fetch(e.url+e.team+t.endPoint,{method:t.method,headers:t.headers,body:t.body}).then((function(e){return e.ok?e.json():Promise.reject("Сервер ответил: ".concat(e.status))})).then((function(e){return e}))},o={token:"d05a1e59-ee23-47c6-b813-a96f22087fe6",team:"wff-cohort-8",url:"https://mesto.nomoreparties.co/v1/",anon:{name:"Аноним",about:"Не удалось идентифицировать пользователя",avatar:"https://img.freepik.com/free-vector/hacker-realistic-composition_98292-38.jpg?t=st=1710733791~exp=1710737391~hmac=20661d5089703d242f7de39d0fe389cc28928ad4bcc00dc8f360be9a5c20ba45&w=1800"},defaultCards:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}]},r=function(e,t,n,o,r,i){var a=t.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter");return e.likes.find((function(e){return e._id===i._id}))&&l.classList.toggle("card__like-button_is-active"),d.textContent=e.likes.length,i._id!=e.owner._id?s.remove():s.addEventListener("click",(function(){return n(a,e._id)})),c.src=e.link,c.alt=e.name,c.onerror=function(){c.src="814749937c60a3f1e04a.jpg",c.alt="Заглушка для не загрузившихся изображений"},u.textContent=e.name,l.addEventListener("click",(function(){o(l,e._id,d)})),c.addEventListener("click",(function(){r(c)})),a},i=function(e,t){(function(e,t){return n(e,{method:"DELETE",endPoint:"/cards/"+t,headers:{authorization:e.token}}).catch((function(e){console.error("Ошибка удаления карточки",e)}))})(o,t).then((function(){e.remove()}))},a=function(e,t,r){e.classList.contains("card__like-button_is-active")?function(e,t){return n(e,{method:"DELETE",endPoint:"/cards/likes/"+t,headers:{authorization:e.token}}).catch((function(e){console.error("Ошибка удаления лайка на сервере",e)}))}(o,t).then((function(t){r.textContent=t.likes.length,e.classList.toggle("card__like-button_is-active")})):function(e,t){return n(e,{method:"PUT",endPoint:"/cards/likes/"+t,headers:{authorization:e.token}}).catch((function(e){console.error("Ошибка отправки лайка на сервер",e)}))}(o,t).then((function(t){r.textContent=t.likes.length,e.classList.toggle("card__like-button_is-active")}))},c=function(e){e.classList.add("popup_is-opened"),p()},u=function(e){e.classList.toggle("popup_is-opened"),f()},s=function(e){if("Escape"===e.key){var t=d();u(t)}},l=function(e){if(e.target.classList.contains("popup_is-opened")){var t=d();u(t)}},d=function(){return document.querySelector(".popup_is-opened")},p=function(){document.addEventListener("click",l),document.addEventListener("keydown",s)},f=function(){document.removeEventListener("click",l),document.removeEventListener("keydown",s)},m=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent="",t.classList.remove(n.inputErrorClass)},v=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},_=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){m(e,n,t)})),v(n,o,t)},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},y=document.querySelector(".page"),k=y.querySelector(".places__list"),S=y.querySelector("#card-template").content,b=y.querySelectorAll(".popup"),E=y.querySelector(".popup_type_edit"),g=y.querySelector(".popup_type_new-card"),C=y.querySelector(".popup_type_image"),q=y.querySelector(".popup_type_edit_avatar"),L=C.querySelector(".popup__image"),x=C.querySelector(".popup__caption"),P=y.querySelectorAll(".popup__close"),A=y.querySelector(".profile__edit-button"),j=y.querySelector(".profile__add-button"),T=document.forms["edit-profile"],z=document.forms["new-place"],w=z.querySelector(".popup__button"),B=document.forms["edit-avatar"],D=B.querySelector(".popup__button"),N=y.querySelector(".profile__title"),O=y.querySelector(".profile__description"),J=y.querySelector(".profile__image"),G=function(e){L.src=e.src,L.alt=e.alt,x.textContent=e.alt,c(C)},H=function(e){k.prepend(e)},M=function(e){t(e).then((function(e){N.textContent=e.name,O.textContent=e.about,J.style.backgroundImage="url("+e.avatar+")"}))};b.forEach((function(e){e.classList.add("popup_is-animated")})),P.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.closest(".popup");u(t)}))})),e=o,Promise.all([t(e),function(e){var t={method:"GET",endPoint:"/cards",headers:{authorization:e.token}};return n(e,t).catch((function(e){console.error("Ошибка запроса карточек",e)}))}(e)]).then((function(t){var n,o,c=t[0];if(c.name!=e.anon.name){var u=t[1];o=c,(n=u).reverse(),n.forEach((function(e){var t=r(e,S,i,a,G,o);H(t)}))}})),M(o),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll("fieldset")).forEach((function(t){return function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);v(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){var o="Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы.";t.validity.patternMismatch?(t.setCustomValidity(o),t.setAttribute("data-error",o)):(t.setCustomValidity(""),t.removeAttribute("data-error")),t.validity.valid?m(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}(e,t,t.validationMessage,n)}(e,r,t),v(n,o,t)}))}))}(t,e)}))}))}(h),A.addEventListener("click",(function(){_(T,h),T.name.value=N.textContent,T.description.value=O.textContent,c(E)})),T.addEventListener("submit",(function(e){e.preventDefault(),t(o).then((function(e){e.name=T.name.value,e.about=T.description.value,function(e,t){var o={method:"PATCH",endPoint:"/users/me",headers:{authorization:e.token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})};return n(e,o).catch((function(e){console.error("Ошибка редактирования пользователя",e)}))}(o,e).then((function(e){N.textContent=e.name,O.textContent=e.about})),u(E)}))})),j.addEventListener("click",(function(){return c(g)})),z.addEventListener("submit",(function(e){e.preventDefault();var c={name:z["place-name"].value,link:z.link.value};w.textContent="Сохранение...",t(o).then((function(e){var t,s,l;(t=o,s=c,l={method:"POST",endPoint:"/cards",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({name:s.name,link:s.link})},n(t,l).catch((function(e){console.error("Ошибка добавления новой карточки",e)}))).then((function(t){var n=r(t,S,i,a,G,e);H(n),u(g),w.textContent="Сохранить"}))})),z.reset(),_(z,h)})),J.addEventListener("click",(function(){c(q)})),B.addEventListener("submit",(function(e){e.preventDefault(),D.textContent="Сохранение...",t(o).then((function(){var e,t,r,i=B.link.value;(e=o,t=i,r={method:"PATCH",endPoint:"/users/me/avatar",headers:{authorization:e.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})},n(e,r).catch((function(e){console.error("Ошибка отправки лайка на сервер",e)}))).then((function(){M(o),u(q),D.textContent="Сохранить"}))}))}))})();