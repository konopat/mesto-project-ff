(()=>{"use strict";var e,t=function(e,t){return fetch(e.url+e.team+t.endPoint,{method:t.method,headers:t.headers,body:t.body}).then((function(e){return e.ok?e.json():Promise.reject("Сервер ответил: ".concat(e.status))})).then((function(e){return e}))},n={token:"d05a1e59-ee23-47c6-b813-a96f22087fe6",team:"wff-cohort-8",url:"https://mesto.nomoreparties.co/v1/",anon:{name:"Аноним",about:"Не удалось идентифицировать пользователя",avatar:"https://img.freepik.com/free-vector/hacker-realistic-composition_98292-38.jpg?t=st=1710733791~exp=1710737391~hmac=20661d5089703d242f7de39d0fe389cc28928ad4bcc00dc8f360be9a5c20ba45&w=1800"},defaultCards:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}]},o=function(e,t,n,o,r,a){var i=t.querySelector(".card").cloneNode(!0),c=i.querySelector(".card__image"),u=i.querySelector(".card__title"),s=i.querySelector(".card__delete-button"),l=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-counter");return e.likes.find((function(e){return e._id===a._id}))&&l.classList.toggle("card__like-button_is-active"),d.textContent=e.likes.length,a._id!=e.owner._id?s.remove():s.addEventListener("click",(function(){return n(i,e._id)})),c.src=e.link,c.alt=e.name,c.onerror=function(){c.src="814749937c60a3f1e04a.jpg",c.alt="Заглушка для не загрузившихся изображений"},u.textContent=e.name,l.addEventListener("click",(function(){o(l,e._id,d)})),c.addEventListener("click",(function(){r(c)})),i},r=function(e,o){(function(e,n){return t(e,{method:"DELETE",endPoint:"/cards/"+n,headers:{authorization:e.token}})})(n,o).then((function(){e.remove()})).catch((function(e){console.error(e)}))},a=function(e,o,r){e.classList.contains("card__like-button_is-active")?function(e,n){return t(e,{method:"DELETE",endPoint:"/cards/likes/"+n,headers:{authorization:e.token}})}(n,o).then((function(t){r.textContent=t.likes.length,e.classList.toggle("card__like-button_is-active")})).catch((function(e){console.error(e)})):function(e,n){return t(e,{method:"PUT",endPoint:"/cards/likes/"+n,headers:{authorization:e.token}})}(n,o).then((function(t){r.textContent=t.likes.length,e.classList.toggle("card__like-button_is-active")})).catch((function(e){console.error(e)}))},i=function(e){e.classList.add("popup_is-opened"),d()},c=function(e){e.classList.toggle("popup_is-opened"),p()},u=function(e){if("Escape"===e.key){var t=l();c(t)}},s=function(e){if(e.target.classList.contains("popup_is-opened")){var t=l();c(t)}},l=function(){return document.querySelector(".popup_is-opened")},d=function(){document.addEventListener("click",s),document.addEventListener("keydown",u)},p=function(){document.removeEventListener("click",s),document.removeEventListener("keydown",u)},f=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent="",t.classList.remove(n.inputErrorClass)},m=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},v=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){f(e,n,t)})),m(n,o,t)},_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},y=document.querySelector(".page"),h=y.querySelector(".places__list"),k=y.querySelector("#card-template").content,b=y.querySelectorAll(".popup"),S=y.querySelector(".popup_type_edit"),g=y.querySelector(".popup_type_new-card"),C=y.querySelector(".popup_type_image"),E=y.querySelector(".popup_type_edit_avatar"),q=C.querySelector(".popup__image"),L=C.querySelector(".popup__caption"),x=y.querySelectorAll(".popup__close"),P=y.querySelector(".profile__edit-button"),A=y.querySelector(".profile__add-button"),j=document.forms["edit-profile"],T=j.querySelector(".popup__button"),z=document.forms["new-place"],w=z.querySelector(".popup__button"),B=document.forms["edit-avatar"],D=B.querySelector(".popup__button"),N=y.querySelector(".profile__title"),O=y.querySelector(".profile__description"),J=y.querySelector(".profile__image"),G=function(e){q.src=e.src,q.alt=e.alt,L.textContent=e.alt,i(C)},H=function(e){h.prepend(e)};b.forEach((function(e){e.classList.add("popup_is-animated")})),x.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.closest(".popup");c(t)}))})),e=n,Promise.all([function(e){var n={method:"GET",endPoint:"/users/me",headers:{authorization:e.token}};return t(e,n)}(e),function(e){var n={method:"GET",endPoint:"/cards",headers:{authorization:e.token}};return t(e,n)}(e)]).then((function(t){var n,i,c=t[0];if(c.name!=e.anon.name){var u=t[1];i=c,(n=u).reverse(),n.forEach((function(e){var t=o(e,k,r,a,G,i);H(t)})),function(e){N.textContent=e.name,O.textContent=e.about,J.style.backgroundImage="url("+e.avatar+")"}(c)}})).catch((function(e){console.error(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll("fieldset")).forEach((function(t){return function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){var o="Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы.";t.validity.patternMismatch?(t.setCustomValidity(o),t.setAttribute("data-error",o)):(t.setCustomValidity(""),t.removeAttribute("data-error")),t.validity.valid?f(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}(e,t,t.validationMessage,n)}(e,r,t),m(n,o,t)}))}))}(t,e)}))}))}(_),P.addEventListener("click",(function(){v(j,_),j.name.value=N.textContent,j.description.value=O.textContent,i(S)})),j.addEventListener("submit",(function(e){e.preventDefault(),T.textContent="Сохранение...";var o={name:j.name.value,about:j.description.value};(function(e,n){var o={method:"PATCH",endPoint:"/users/me",headers:{authorization:e.token,"Content-Type":"application/json"},body:JSON.stringify({name:n.name,about:n.about})};return t(e,o)})(n,o).then((function(e){N.textContent=e.name,O.textContent=e.about,c(S)})).finally((function(){T.textContent="Сохранить"})).catch((function(e){console.error(e)}))})),A.addEventListener("click",(function(){return i(g)})),z.addEventListener("submit",(function(e){e.preventDefault();var i,u,s,l={name:z["place-name"].value,link:z.link.value};w.textContent="Сохранение...",(i=n,u=l,s={method:"POST",endPoint:"/cards",headers:{authorization:i.token,"Content-Type":"application/json"},body:JSON.stringify({name:u.name,link:u.link})},t(i,s)).then((function(e){var t=o(e,k,r,a,G,e.owner);H(t),z.reset(),v(z,_),c(g)})).finally((function(){w.textContent="Сохранить"})).catch((function(e){console.error(e)}))})),J.addEventListener("click",(function(){i(E)})),B.addEventListener("submit",(function(e){e.preventDefault(),D.textContent="Сохранение...";var o,r,a,i=B.link.value;(o=n,r=i,a={method:"PATCH",endPoint:"/users/me/avatar",headers:{authorization:o.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})},t(o,a)).then((function(e){J.style.backgroundImage="url("+e.avatar+")",c(E),B.reset(),v(B,_)})).finally((function(){D.textContent="Сохранить"})).catch((function(e){console.error(e)}))}))})();